[
  {
    "name": "common_counter",
    "comment": "Общий счетчик для всех типов сообщений",
    "indexTypeName": "idx_f2",
    "computationConditions": {
      "t": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    },
    "evaluationConditions": {
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -700
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "count_distinct": {
        "$addToSet": "$d.f1"
      },
      "avg_amount": {
        "$avg": "$d.a"
      }
    },
    "fromTimeMs": 31536000000,
    "toTimeMs": 0,
    "maxEvaluatedRecords": 1000,
    "maxMatchingRecords": 1000
  },
  {
    "name": "test_counter_1_f1_string_filter",
    "comment": "Тестовый счетчик для поля f1 с фильтрацией строковых значений",
    "indexTypeName": "idx_f1",
    "computationConditions": {
      "d.f1": {
        "$regex": "^123456",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -1
            }
          }
        ]
      },
      "fromTimeMs": 31536000000,
      "toTimeMs": 0,
      "maxEvaluatedRecords": 1000,
      "maxMatchingRecords": 1000
    },
    "evaluationConditions": {
      "d.f1": {
        "$in": ["1234567890", "1111111111", "2222222222"]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -2
            }
          }
        ]
      },
      "fromTimeMs": 31536000000,
      "toTimeMs": 0,
      "maxEvaluatedRecords": 100,
      "maxMatchingRecords": 5
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      }
    },
    "fromTimeMs": 31536000000,
    "toTimeMs": 0,
    "maxEvaluatedRecords": 1000,
    "maxMatchingRecords": 10    
  },
  {
    "name": "test_counter_2_f2_enum_filter",
    "comment": "Тестовый счетчик для поля f2 с фильтрацией enum значений",
    "indexTypeName": "idx_f2",
    "computationConditions": {
      "d.f2": {
        "$in": ["value1", "value2", "value3"]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -1
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f2": {
        "$regex": "value[1-5]",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -2
            }
          }
        ]
      },
      "fromTimeMs": 31536000000,
      "toTimeMs": 0,
      "maxEvaluatedRecords": 1000,
      "maxMatchingRecords": 500
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "max_amount": {
        "$max": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_3_f3_numeric_enum",
    "comment": "Тестовый счетчик для поля f3 с числовыми enum значениями",
    "indexTypeName": "idx_f3",
    "computationConditions": {
      "d.f3": {
        "$gte": 1,
        "$lte": 5
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -3
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f3": {
        "$in": [1, 2, 3, 4, 5]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -6
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "min_amount": {
        "$min": "$d.a"
      },
      "avg_amount": {
        "$avg": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_4_f4_regex_pattern",
    "comment": "Тестовый счетчик для поля f4 с regex паттернами",
    "indexTypeName": "idx_f4",
    "computationConditions": {
      "d.f4": {
        "$regex": "[a-z]$",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -365
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f4": {
        "$regex": "^(111|222|333)",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "minute",
              "amount": -60
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "count_distinct": {
        "$addToSet": "$d.f4"
      }
    }
  },
  {
    "name": "test_counter_5_f5_amount_range",
    "comment": "Тестовый счетчик для поля f5 с диапазоном сумм",
    "indexTypeName": "idx_f5",
    "computationConditions": {
      "d.f5": {
        "$regex": "^[4-6]",
        "$options": "i"
      },
      "d.a": {
        "$gte": 1000,
        "$lte": 5000
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -4
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f5": {
        "$in": ["4444444444", "5555555555", "6666666666"]
      },
      "d.a": {
        "$gte": 2000,
        "$lte": 8000
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -8
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "max_amount": {
        "$max": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_6_f6_time_window",
    "comment": "Тестовый счетчик для поля f6 с временным окном",
    "indexTypeName": "idx_f6",
    "computationConditions": {
      "t": [7, 8, 9],
      "d.f6": {
        "$regex": "^[7-9]",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -1
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f6": {
        "$in": ["7777777777", "8888888888", "9999999999"]
      },
      "$expr": {
        "$and": [
          {
            "$gte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "day",
                  "amount": -2
                }
              }
            ]
          },
          {
            "$lte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "hour",
                  "amount": -1
                }
              }
            ]
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "avg_amount": {
        "$avg": "$d.a"
      },
      "min_amount": {
        "$min": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_7_f7_mixed_conditions",
    "comment": "Тестовый счетчик для поля f7 со смешанными условиями",
    "indexTypeName": "idx_f7",
    "computationConditions": {
      "d.f7": {
        "$regex": "^[1-3]",
        "$options": "i"
      },
      "d.f2": {
        "$ne": "value10"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -2
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f7": {
        "$in": ["1111111111", "2222222222", "3333333333"]
      },
      "d.f2": {
        "$in": ["value1", "value2", "value3", "value4", "value5"]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -4
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "count_f2_values": {
        "$addToSet": "$d.f2"
      }
    }
  },
  {
    "name": "test_counter_8_f8_regex_complex",
    "comment": "Тестовый счетчик для поля f8 со сложными regex условиями",
    "indexTypeName": "idx_f8",
    "computationConditions": {
      "d.f8": {
        "$regex": "^(4|5|6).*4$",
        "$options": "i"
      },
      "d.f3": {
        "$gte": 3,
        "$lte": 8
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -6
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f8": {
        "$regex": "^(444|555|666)",
        "$options": "i"
      },
      "d.f3": {
        "$in": [3, 4, 5, 6, 7, 8]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -12
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "max_amount": {
        "$max": "$d.a"
      },
      "avg_amount": {
        "$avg": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_9_f9_time_range",
    "comment": "Тестовый счетчик для поля f9 с временным диапазоном",
    "indexTypeName": "idx_f9",
    "computationConditions": {
      "d.f9": {
        "$regex": "^[3-4]",
        "$options": "i"
      },
      "$expr": {
        "$and": [
          {
            "$gte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "day",
                  "amount": -3
                }
              }
            ]
          },
          {
            "$lte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "hour",
                  "amount": -1
                }
              }
            ]
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f9": {
        "$in": ["3333333333", "4444444444"]
      },
      "$expr": {
        "$and": [
          {
            "$gte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "day",
                  "amount": -5
                }
              }
            ]
          },
          {
            "$lte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "hour",
                  "amount": -2
                }
              }
            ]
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "min_amount": {
        "$min": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_10_f10_amount_threshold",
    "comment": "Тестовый счетчик для поля f10 с пороговыми значениями сумм",
    "indexTypeName": "idx_f10",
    "computationConditions": {
      "d.f10": {
        "$regex": "^[1-3]",
        "$options": "i"
      },
      "d.a": {
        "$gte": 5000
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -8
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f10": {
        "$in": ["1111111111", "2222222222", "3333333333"]
      },
      "d.a": {
        "$gte": 8000
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -16
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "max_amount": {
        "$max": "$d.a"
      },
      "avg_amount": {
        "$avg": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_11_f11_specific_values",
    "comment": "Тестовый счетчик для поля f11 с конкретными значениями",
    "indexTypeName": "idx_f11",
    "computationConditions": {
      "d.f11": {
        "$in": ["5555555555", "7777777777"]
      },
      "d.f2": {
        "$regex": "value[5-7]",
        "$options": "i"
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -12
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f11": {
        "$regex": "^(555|777)",
        "$options": "i"
      },
      "d.f2": {
        "$in": ["value5", "value6", "value7"]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -24
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "count_f2_distinct": {
        "$addToSet": "$d.f2"
      }
    }
  },
  {
    "name": "test_counter_12_f12_pattern_match",
    "comment": "Тестовый счетчик для поля f12 с паттерн-матчингом",
    "indexTypeName": "idx_f12",
    "computationConditions": {
      "d.f12": {
        "$regex": "^[2-4].*[2-4]$",
        "$options": "i"
      },
      "d.f3": {
        "$gte": 2,
        "$lte": 6
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -1
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f12": {
        "$in": ["2222222222", "3333333333", "4444444444"]
      },
      "d.f3": {
        "$in": [2, 3, 4, 5, 6]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -2
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "avg_amount": {
        "$avg": "$d.a"
      },
      "min_amount": {
        "$min": "$d.a"
      },
      "max_amount": {
        "$max": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_13_f13_multi_field",
    "comment": "Тестовый счетчик для поля f13 с множественными полями",
    "indexTypeName": "idx_f13",
    "computationConditions": {
      "d.f13": {
        "$regex": "^[3-5]",
        "$options": "i"
      },
      "d.f2": {
        "$ne": "value1"
      },
      "d.f3": {
        "$gte": 4
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -6
            }
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f13": {
        "$in": ["3333333333", "4444444444", "5555555555"]
      },
      "d.f2": {
        "$in": [
          "value2",
          "value3",
          "value4",
          "value5",
          "value6",
          "value7",
          "value8",
          "value9",
          "value10"
        ]
      },
      "d.f3": {
        "$gte": 5
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "hour",
              "amount": -12
            }
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "count_f2_values": {
        "$addToSet": "$d.f2"
      },
      "count_f3_values": {
        "$addToSet": "$d.f3"
      }
    }
  },
  {
    "name": "test_counter_14_f14_time_series",
    "comment": "Тестовый счетчик для поля f14 с временными рядами",
    "indexTypeName": "idx_f14",
    "computationConditions": {
      "d.f14": {
        "$regex": "^[1-3]",
        "$options": "i"
      },
      "d.a": {
        "$gte": 2000,
        "$lte": 7000
      },
      "$expr": {
        "$and": [
          {
            "$gte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "hour",
                  "amount": -4
                }
              }
            ]
          },
          {
            "$lte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "minute",
                  "amount": -30
                }
              }
            ]
          }
        ]
      }
    },
    "evaluationConditions": {
      "d.f14": {
        "$in": ["1111111111", "2222222222", "3333333333"]
      },
      "d.a": {
        "$gte": 3000,
        "$lte": 9000
      },
      "$expr": {
        "$and": [
          {
            "$gte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "hour",
                  "amount": -8
                }
              }
            ]
          },
          {
            "$lte": [
              "$d.dt",
              {
                "$dateAdd": {
                  "startDate": "$$NOW",
                  "unit": "minute",
                  "amount": -15
                }
              }
            ]
          }
        ]
      }
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "avg_amount": {
        "$avg": "$d.a"
      },
      "min_amount": {
        "$min": "$d.a"
      },
      "max_amount": {
        "$max": "$d.a"
      }
    }
  },
  {
    "name": "test_counter_15_f15_complex_regex",
    "comment": "Тестовый счетчик для поля f15 со сложными regex выражениями",
    "indexTypeName": "idx_f15",
    "computationConditions": {
      "d.f15": {
        "$regex": "^(1|2).*[0-9]{8}$",
        "$options": "i"
      },
      "d.f2": {
        "$regex": "value[1-3]",
        "$options": "i"
      },
      "d.f3": {
        "$in": [1, 2, 3]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -1
            }
          }
        ]
      },
      "fromTimeMs": 31536000000,
      "toTimeMs": 0,
      "maxEvaluatedRecords": 100,
      "maxMatchingRecords": 5
    },
    "evaluationConditions": {
      "d.f15": {
        "$in": ["1111111111", "2222222222"]
      },
      "d.f2": {
        "$in": ["value1", "value2", "value3"]
      },
      "d.f3": {
        "$in": [1, 2, 3]
      },
      "$expr": {
        "$gte": [
          "$d.dt",
          {
            "$dateAdd": {
              "startDate": "$$NOW",
              "unit": "day",
              "amount": -2
            }
          }
        ]
      },
      "fromTimeMs": 31536000000,
      "toTimeMs": 0,
      "maxEvaluatedRecords": 100,
      "maxMatchingRecords": 5
    },
    "attributes": {
      "cnt": {
        "$sum": 1
      },
      "sum_amount": {
        "$sum": "$d.a"
      },
      "avg_amount": {
        "$avg": "$d.a"
      },
      "count_f2_distinct": {
        "$addToSet": "$d.f2"
      },
      "count_f3_distinct": {
        "$addToSet": "$d.f3"
      }
    },
    "fromTimeMs": 31536000000,
    "toTimeMs": 0,
    "maxEvaluatedRecords": 100,
    "maxMatchingRecords": 5
}
]
