[
    {
        "name": "i_CP_risk_mcc_same_mi_rus_1h",
        "comment": "i_CP_risk_mcc_same_mi_rus_1h - подсчет количества",
        "condition": {
            "messageTypeId": [50, 70]
        },
        "aggregate": [
            {
              "$match": {
                "pin_flag": false,
                "de22": { "$not": { "$regex": "^(01|81|10|82)" } },
                "de3": { "$not": { "$regex": "^(5|2)" } },
                "mti": { "$nin": ["0400", "0410", "0420", "0430"] },
                "$or": [
                  { "status": { "$ne": "R" } },
                  { "status": null },
                  { "status": { "$exists": false } }
                ],
                "mcc": { "$in": ["5813", "5812", "7273", "5732", "4812", "5211", "5094", "5944", "5411", "5499", "5814", "5311", "5541", "5331", "5999"] },
                "de42": "{i_merchant_id}",
                "token_flag": false,
                "response": "00",
                "country": "643"
              }
            },
            {
              "$group": {
                "_id": null,
                "cnt": { "$sum": 1 },
                "sum": { "$sum": "$amount" }
              }
            }
          ]
    },
    {
        "name": "i_CP_risk_mcc_same_mi_rus_all_1h",
        "comment": "i_CP_risk_mcc_same_mi_rus_all_1h - сумма amount с другим набором MCC",
        "condition": {
            "messageTypeId": [50, 70]
        },
        "aggregate": [
            {
              "$match": {
                "pin_flag": false,
                "de22": { "$not": { "$regex": "^(01|81|10|82)" } },
                "de3": { "$not": { "$regex": "^(5|2)" } },
                "mti": { "$nin": ["0400", "0410", "0420", "0430"] },
                "$or": [
                  { "status": { "$ne": "R" } },
                  { "status": null },
                  { "status": { "$exists": false } }
                ],
                "mcc": { "$in": ["5732", "4812", "5211", "5094", "5944", "5411", "5499", "5814", "5311", "5541", "5331", "5999"] },
                "de42": "{i_merchant_id}",
                "token_flag": false,
                "country": "643"
              }
            },
            {
              "$group": {
                "_id": null,
                "cnt": { "$sum": 1 },
                "sum": { "$sum": "$amount" }
              }
            }
          ]
    }
]