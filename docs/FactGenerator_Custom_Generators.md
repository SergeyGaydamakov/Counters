# FactGenerator - Кастомные генераторы значений

## Обзор

В FactGenerator добавлена поддержка кастомных правил генерации значений для полей через конфигурацию в поле `generator`. Это позволяет точно контролировать типы и диапазоны генерируемых значений для каждого поля.

## Поддерживаемые типы генераторов

### 1. String (строка)
Генерирует случайные строки из латинских символов.

```json
{
  "generator": {
    "type": "string",
    "min": 5,
    "max": 15,
    "default_value": "DEFAULT_STRING",
    "default_random": 0.1
  }
}
```

**Параметры:**
- `min` (опционально) - минимальная длина строки (по умолчанию: 6)
- `max` (опционально) - максимальная длина строки (по умолчанию: 20)
- `default_value` (опционально) - значение по умолчанию (строка)
- `default_random` (опционально) - вероятность использования значения по умолчанию (0-1)

### 2. Integer (целое число)
Генерирует случайные целые числа в заданном диапазоне.

```json
{
  "generator": {
    "type": "integer",
    "min": 100,
    "max": 1000,
    "default_value": 999,
    "default_random": 0.2
  }
}
```

**Параметры:**
- `min` (опционально) - минимальное значение (по умолчанию: 0)
- `max` (опционально) - максимальное значение (по умолчанию: 100)
- `default_value` (опционально) - значение по умолчанию (целое число)
- `default_random` (опционально) - вероятность использования значения по умолчанию (0-1)

### 3. Date (дата)
Генерирует случайные даты в заданном диапазоне.

```json
{
  "generator": {
    "type": "date",
    "min": "2024-01-01",
    "max": "2024-12-31",
    "default_value": "2024-06-15",
    "default_random": 0.15
  }
}
```

**Параметры:**
- `min` (опционально) - минимальная дата в формате строки (по умолчанию: fromDate конструктора)
- `max` (опционально) - максимальная дата в формате строки (по умолчанию: toDate конструктора)
- `default_value` (опционально) - значение по умолчанию (строка с датой или Date объект)
- `default_random` (опционально) - вероятность использования значения по умолчанию (0-1)

### 4. Enum (перечисление)
Генерирует случайные значения из заданного списка.

```json
{
  "generator": {
    "type": "enum",
    "values": ["option1", "option2", "option3", "option4"],
    "default_value": "option2",
    "default_random": 0.4
  }
}
```

**Параметры:**
- `values` (обязательно) - массив возможных значений
- `default_value` (опционально) - значение по умолчанию (должно быть в массиве values)
- `default_random` (опционально) - вероятность использования значения по умолчанию (0-1)

## Дополнительные параметры генерации

### default_value
Значение по умолчанию, которое будет использоваться с заданной вероятностью вместо случайно сгенерированного значения.

- Для `string` - должна быть строка
- Для `integer` - должно быть целое число
- Для `date` - должна быть строка с датой или Date объект
- Для `enum` - должно быть одним из значений в массиве `values`

### default_random
Вероятность использования `default_value` вместо случайного значения. Должна быть числом от 0 до 1:
- `0` - никогда не использовать default_value
- `0.1` - использовать default_value в 10% случаев
- `0.5` - использовать default_value в 50% случаев
- `1` - всегда использовать default_value

## Значение по умолчанию

Если поле не имеет конфигурации `generator` или `generator` не указан, используется значение по умолчанию:
- **Тип:** string
- **min:** 6
- **max:** 20

## Пример конфигурации

```json
[
  {
    "src": "userId",
    "dst": "userId",
    "fact_types": [1, 2, 3],
    "generator": {
      "type": "integer",
      "min": 1000,
      "max": 9999,
      "default_value": 1234,
      "default_random": 0.1
    }
  },
  {
    "src": "userName",
    "dst": "userName",
    "fact_types": [1, 2],
    "generator": {
      "type": "string",
      "min": 5,
      "max": 15,
      "default_value": "admin",
      "default_random": 0.05
    }
  },
  {
    "src": "actionType",
    "dst": "actionType",
    "fact_types": [1, 2, 3],
    "generator": {
      "type": "enum",
      "values": ["login", "logout", "purchase", "view", "search"],
      "default_value": "login",
      "default_random": 0.2
    }
  },
  {
    "src": "eventDate",
    "dst": "eventDate",
    "fact_types": [2, 3],
    "generator": {
      "type": "date",
      "min": "2024-01-01",
      "max": "2024-12-31",
      "default_value": "2024-06-15",
      "default_random": 0.15
    }
  },
  {
    "src": "description",
    "dst": "description",
    "fact_types": [1, 2, 3]
    // Без generator - будет использовано значение по умолчанию
  }
]
```

## Валидация

Система автоматически валидирует конфигурацию генераторов:

- Проверяется корректность типа генератора
- Валидируются параметры в зависимости от типа
- Проверяются диапазоны значений (min ≤ max)
- Для enum проверяется, что массив values не пустой
- Для date проверяется корректность формата дат
- Для default_value проверяется соответствие типу генератора
- Для default_random проверяется, что значение находится в диапазоне 0-1
- Для enum default_value проверяется, что значение присутствует в массиве values

## Использование

```javascript
const FactGenerator = require('./generators/factGenerator');

// Создание генератора с кастомной конфигурацией
const generator = new FactGenerator(customFieldConfig);

// Генерация факта
const fact = generator.generateFact(1);
console.log(fact.userId);    // Случайное число от 1000 до 9999 (10% вероятность получить 1234)
console.log(fact.userName);  // Случайная строка от 5 до 15 символов (5% вероятность получить "admin")
console.log(fact.actionType); // Случайное значение из enum (20% вероятность получить "login")
console.log(fact.eventDate);  // Случайная дата в диапазоне (15% вероятность получить "2024-06-15")
console.log(fact.description); // Случайная строка от 6 до 20 символов (по умолчанию)
```

## Обратная совместимость

Все существующие конфигурации без поля `generator` продолжают работать без изменений, используя значения по умолчанию.
